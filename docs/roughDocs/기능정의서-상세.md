# 기능 정의서

- **프로그램 이름**: ResidenceManager
- **설명**: Revit 모델 내 세대 및 층 정보를 관리하고 시각화하는 Revit 플러그인

---

## 📌 기능 1 : 세대별 정보 조회 / 수정

- **설명** : Revit 모델 내 Room 요소를 가져와 속성별로 UI에 출력
- **입력 데이터**
  - UI를 실행할 때는 Revit 모델 내부에서 자동 수집
  - 수정시에는 UI에서 입력
- **처리 로직** :
  1. 호수를 입력하여 `Room` 요소 검색
  2. 각 `Room`의 파라미터 추출
      - `호수`, `면적`, `입주여부`
      - ---- 여기부터는 외부에 DB 혹은 JSON파일로 저장 고려중 ----
      - `입주인원`, `연락처`, `차량번호`, `반려동물 현황`
      - `특이사항`
      - `문의내역`
  3. UI에서 수정할 정보를 입력하고 해당 정보를 Revit의 각 파라미터에 저장
- **출력 데이터** : 
  - 전체적인 정보를 UI에 모두 표시
  - 이때 해당 세대의 평면 혹은 3D뷰도 함께 표시


### 💭 고려사항 (문의내역 관련)

- 문의 내역은 구조상 리스트 형태이며, Room 하나당 복수의 항목을 저장해야 함  
- Revit의 Room 요소에는 구조적으로 다수의 텍스트 항목을 직접 저장하기에 한계가 있음  
  - → 사용자 지정 파라미터는 단일 값만 저장 가능 (리스트 형태 저장 불가)

- **고려 중인 해결 방안**
  1. 문의 내역을 외부 JSON 파일로 저장하고 Room ID 기준으로 연동
  2. 임베디드 SQLite 등으로 로컬 DB를 연결하여 Room ID 기준으로 CRUD
  3. Revit 내 Schedule을 활용해 연결 정보 생성 (Revit이 무거워질 가능성)

- **선정 방안** : Revit파일 위치 기준으로 `Residence Info` 폴더를 생성해 JSON파일을 저장


### 📦 Revit 내부 파라미터
- 사용 파라미터 목록 (Revit 내부)
  - `호수 (Room Number)`
  - `면적 (Area)`
  - `입주여부 (Occupancy)`

### 📦 JSON 구조 예시
```JSON
{
  "room-101": {
    "입주인원": 3,
    "연락처": "010-1234-5678",
    "차량번호": [ "12가 3456", "45나 7890" ],
    "반려동물": "고양이 1마리, 강아지 2마리",
    "특이사항": "엘리베이터 근처",
    "문의내역": [
      {
        "제목": "에어컨 고장",
        "분류": "가전",
        "내용": "리모컨 작동 안됨",
        "작성일": "2025-04-23"
      },
      {
        "제목": "화장실 누수",
        "분류": "설비",
        "내용": "세면대 아래 물샘",
        "작성일": "2025-04-20"
      }
    ]
  }
}
```
### 💭 고려사항 (파일 읽기 성능 관련) -> 전체 문의내역 읽기 기능에서

- 세대별 문의내역을 개별 JSON 파일로 저장하는 구조는 유지보수와 파일 이식성 측면에서 유리함
- 다만 전체 세대의 문의내역을 한 번에 조회할 경우,
**다수의 파일을 순차적으로 읽어야 하므로 로딩 시간이 소요될 수 있음**
- 이로 인한 성능 저하를 방지하기 위해 다음과 같은 전략을 고려함:
  1. **비동기 파일 읽기(Async I/O)**: UI 멈춤 현상 없이 백그라운드에서 파일을 병렬로 읽어들임
  2. **로컬 캐싱**: 최초 로딩 시 데이터를 메모리에 저장하고, 이후 동일한 요청 시 캐시 데이터를 재사용
  3. (선택 사항) **주기적 통합 파일 생성**: 다수의 JSON을 통합한 요약 파일을 생성하여 빠른 접근 제공

⚠️ 현재 프로젝트 규모(예: 수십~수백 세대)에서는 **비동기 처리 + 캐싱** 만으로 충분한 성능 확보가 가능하다고 파악됨

---

## 📌 기능 2 : 층별 필터링

- **설명** : 특정 Level(층)에 속한 세대만 조회할 수 있도록 필터 적용
- **입력 데이터** : 사용자가 선택한 Level 정보
- **처리 로직** :
  1. 전체 Room 중 `Room.Level` 값이 선택된 층과 일치하는 것만 필터링
  2. 필터링된 리스트를 UI에 출력
- **출력 데이터** : 층별 세대 목록

---

## 📌 기능 3 : 건물 요약 통계

- **설명**: 전체 모델에 존재하는 세대 수, 전체 면적 등을 요약
- **입력 데이터**: Revit 모델 내 모든 Room 요소
- **처리 로직**:
  1. Room 수 세기
  2. Room 면적 합산
  3. 층(Level) 별 분포 확인
- **출력 데이터**: 세대 수, 총 면적, 층별 통계 등

---

## 📌 기능 4 : 정보 엑셀 내보내기 (선택 기능)

- **설명**: 현재 세대 리스트를 Excel(.xlsx) 파일로 저장
- **입력 데이터**: 현재 화면에 표시된 Room 데이터
- **처리 로직**:
  1. Excel 라이브러리로 시트 생성
  2. 리스트 데이터를 셀에 기록
  3. 사용자 저장 경로에 파일로 저장
- **출력 데이터**: Excel 파일

---